From 688be9a261c9d00d6b662cef96359d63e5da68a2 Mon Sep 17 00:00:00 2001
From: Martyn Taylor <mtaylor@redhat.com>
Date: Thu, 16 Mar 2017 12:14:13 +0000
Subject: [PATCH 2/3] Some logging

---
 .../apache/activemq/artemis/core/replication/ReplicationEndpoint.java | 1 +
 .../apache/activemq/artemis/core/replication/ReplicationManager.java  | 4 +++-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/artemis-server/src/main/java/org/apache/activemq/artemis/core/replication/ReplicationEndpoint.java b/artemis-server/src/main/java/org/apache/activemq/artemis/core/replication/ReplicationEndpoint.java
index 23f9c40..2802c91 100644
--- a/artemis-server/src/main/java/org/apache/activemq/artemis/core/replication/ReplicationEndpoint.java
+++ b/artemis-server/src/main/java/org/apache/activemq/artemis/core/replication/ReplicationEndpoint.java
@@ -432,6 +432,7 @@ public final class ReplicationEndpoint implements ChannelHandler, ActiveMQCompon
          return replicationResponseMessage;
 
       if (packet.isSynchronizationFinished()) {
+         logger.trace("Sync Finished Packet Received for node: " + packet.getNodeID());
          finishSynchronization(packet.getNodeID());
          replicationResponseMessage.setSynchronizationIsFinishedAcknowledgement(true);
          return replicationResponseMessage;
diff --git a/artemis-server/src/main/java/org/apache/activemq/artemis/core/replication/ReplicationManager.java b/artemis-server/src/main/java/org/apache/activemq/artemis/core/replication/ReplicationManager.java
index 97bd077..788021d 100644
--- a/artemis-server/src/main/java/org/apache/activemq/artemis/core/replication/ReplicationManager.java
+++ b/artemis-server/src/main/java/org/apache/activemq/artemis/core/replication/ReplicationManager.java
@@ -356,7 +356,9 @@ public final class ReplicationManager implements ActiveMQComponent, ReadyListene
       synchronized (replicationLock) {
          if (enabled) {
             pendingTokens.add(repliToken);
-            replicatingChannel.sendAndFlush(packet);
+            if (!replicatingChannel.sendAndFlush(packet)) {
+               throw new RuntimeException("Didn't write packet");
+            }
          } else {
             // Already replicating channel failed, so just play the action now
             runItNow = true;
-- 
2.7.4

